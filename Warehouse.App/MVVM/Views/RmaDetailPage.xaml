<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="Warehouse.App.MVVM.Views.RmaDetailPage"
             x:Name="RmaDetailPageRoot"
             Title="Book RMA">
    <ScrollView>
        <VerticalStackLayout Padding="20" Spacing="16">
            <Label Text="Order" FontSize="18" FontAttributes="Bold" Margin="16 ,10,0,0"/>
            <Border Stroke="Gray" Padding="16" Margin="0,0,0,10">
                <VerticalStackLayout>
                    <Grid IsVisible="{OnPlatform  Default=True, Android=False, iOS=False, MacCatalyst=False}"
                          ColumnDefinitions="Auto,Auto,100,Auto,Auto"
                          RowDefinitions="Auto,Auto,Auto,Auto"
                          RowSpacing="8"
                          ColumnSpacing="18">
                        <Label Text="Platform:" FontAttributes="Bold" Grid.Row="0" Grid.Column="0"/>
                        <Label Text="{Binding ReturnMerchandiseAuthorization.Platform}" Grid.Row="0" Grid.Column="1"/>

                        <Label Text="Channel:" FontAttributes="Bold" Grid.Row="0" Grid.Column="3"/>
                        <Label Text="{Binding ReturnMerchandiseAuthorization.Channel}" Grid.Row="0" Grid.Column="4"/>

                        <Label Text="Order ID:" FontAttributes="Bold" Grid.Row="1" Grid.Column="0"/>
                        <Label Text="{Binding ReturnMerchandiseAuthorization.OrderId}" Grid.Row="1" Grid.Column="1"/>

                        <Label Text="Return Request ID:" FontAttributes="Bold" Grid.Row="1" Grid.Column="3"/>
                        <Label Text="{Binding ReturnMerchandiseAuthorization.ReturnRequestId}" Grid.Row="1" Grid.Column="4"/>

                        <Label Text="Distribution Center:" FontAttributes="Bold" Grid.Row="2" Grid.Column="0"/>
                        <Label Text="{Binding ReturnMerchandiseAuthorization.DistributionCenter}" Grid.Row="2" Grid.Column="1"/>

                        <Label Text="Currency:" FontAttributes="Bold" Grid.Row="2" Grid.Column="3"/>
                        <Label Text="{Binding ReturnMerchandiseAuthorization.Currency}" Grid.Row="2" Grid.Column="4"/>

                        <Label Text="Track And Trace:" FontAttributes="Bold" Grid.Row="3" Grid.Column="0"/>
                        <CollectionView Grid.Row="3" Grid.Column="1" Grid.ColumnSpan="4" ItemsSource="{Binding ReturnMerchandiseAuthorization.TrackAndTrace}">
                            <CollectionView.ItemTemplate>
                                <DataTemplate>
                                    <Label Text="{Binding}" />
                                </DataTemplate>
                            </CollectionView.ItemTemplate>
                        </CollectionView>
                    </Grid>
                    <Grid IsVisible="{OnPlatform Default=False, Android=True, iOS=True, MacCatalyst=False}"
                          ColumnDefinitions="Auto,Auto"
                          RowDefinitions="Auto,Auto,Auto,Auto,Auto,Auto,Auto"
                          RowSpacing="8"
                          ColumnSpacing="18">
                        <Label Text="Platform:" FontAttributes="Bold"  Grid.Row="0" Grid.Column="0"/>
                        <Label Text="{Binding ReturnMerchandiseAuthorization.Platform}"  Grid.Row="0" Grid.Column="1"/>

                        <Label Text="Channel:" FontAttributes="Bold"  Grid.Row="1" Grid.Column="0"/>
                        <Label Text="{Binding ReturnMerchandiseAuthorization.Channel}"  Grid.Row="1" Grid.Column="1"/>

                        <Label Text="Order ID:" FontAttributes="Bold"  Grid.Row="2" Grid.Column="0"/>
                        <Label Text="{Binding ReturnMerchandiseAuthorization.OrderId}"  Grid.Row="2" Grid.Column="1" />

                        <Label Text="Return Request ID:" FontAttributes="Bold"  Grid.Row="3" Grid.Column="0"/>
                        <Label Text="{Binding ReturnMerchandiseAuthorization.ReturnRequestId}"  Grid.Row="3" Grid.Column="1"/>

                        <Label Text="Distribution Center:" FontAttributes="Bold"  Grid.Row="4" Grid.Column="0"/>
                        <Label Text="{Binding ReturnMerchandiseAuthorization.DistributionCenter}"  Grid.Row="4" Grid.Column="1"/>

                        <Label Text="Currency:" FontAttributes="Bold"  Grid.Row="5" Grid.Column="0"/>
                        <Label Text="{Binding ReturnMerchandiseAuthorization.Currency}"  Grid.Row="5" Grid.Column="1"/>

                        <Label Text="Track And Trace:" FontAttributes="Bold"  Grid.Row="6" Grid.Column="0"/>
                        <CollectionView ItemsSource="{Binding ReturnMerchandiseAuthorization.TrackAndTrace}"  Grid.Row="6" Grid.Column="1">
                            <CollectionView.ItemTemplate>
                                <DataTemplate>
                                    <Label Text="{Binding}" />
                                </DataTemplate>
                            </CollectionView.ItemTemplate>
                        </CollectionView>
                    </Grid>
                </VerticalStackLayout>
            </Border>

            <Label Text="Lines" FontSize="18" FontAttributes="Bold" Margin="16,10,0,0"/>
            <Grid  IsVisible="{OnPlatform  Default=True, Android=False, iOS=False, MacCatalyst=False}"
                   ColumnDefinitions="100,*,*,*,*,*,50" Padding="16,0">
                <Label Text="Line ID" FontAttributes="Bold" />
                <Label Text="Article Code" FontAttributes="Bold" Grid.Column="1"/>
                <Label Text="Quantity" FontAttributes="Bold" Grid.Column="2"/>
                <Label Text="Reason" FontAttributes="Bold" Grid.Column="3"/>
                <Label Text="Resolution" FontAttributes="Bold" Grid.Column="4"/>
                <Label Text="Condition" FontAttributes="Bold" Grid.Column="5"/>
            </Grid>

            <!-- Table Rows -->
            <CollectionView ItemsSource="{Binding Lines}">
                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <Border Stroke="Gray" Padding="16" Margin="0,8">
                            <VerticalStackLayout>
                                <Grid IsVisible="{OnPlatform  Default=True, Android=False, iOS=False, MacCatalyst=False}"
                                      ColumnDefinitions="100,*,*,*,*,*,50">
                                    <Label VerticalTextAlignment="Center" Text="{Binding LineId}" />
                                    <Label VerticalTextAlignment="Center" Text="{Binding ArticleCode}" Grid.Column="1"/>
                                    <HorizontalStackLayout Grid.Column="2" HorizontalOptions="Start" Spacing="4">
                                        <Button Text="-" 
                                                Command="{Binding DecrementQuantityCommand}" 
                                                WidthRequest="32" HeightRequest="32"/>
                                        <Label Text="{Binding Quantity}" 
                                                WidthRequest="40"
                                                HorizontalTextAlignment="Center"
                                                VerticalTextAlignment="Center"
                                                FontSize="16"/>
                                        <Button Text="+"
                                                Command="{Binding IncrementQuantityCommand}" 
                                                WidthRequest="32" HeightRequest="32"/>
                                    </HorizontalStackLayout>
                                    <Label VerticalTextAlignment="Center" Text="{Binding Reason}" Grid.Column="3"/>
                                    <Picker Grid.Column="4"
                                            SelectedItem="{Binding Resolution, Mode=TwoWay}"
                                            VerticalOptions="Center"
                                            WidthRequest="200"
                                            HorizontalOptions="Start">
                                        <Picker.Items>
                                            <x:String>refund</x:String>
                                            <x:String>doNotRefund</x:String>
                                            <x:String>check</x:String>
                                        </Picker.Items>
                                    </Picker>
                                    <Picker Grid.Column="5"
                                            SelectedItem="{Binding Condition, Mode=TwoWay}"
                                            VerticalOptions="Center"
                                            WidthRequest="200"
                                            HorizontalOptions="Start">
                                        <Picker.Items>
                                            <x:String>secondChange</x:String>
                                            <x:String>restockable</x:String>
                                            <x:String>scrap</x:String>
                                        </Picker.Items>
                                    </Picker>
                                    <Button Grid.Column="6"
                                            Text="Delete"
                                            Command="{Binding BindingContext.DeleteLineCommand, Source={x:Reference RmaDetailPageRoot}}"
                                            CommandParameter="{Binding .}"
                                            BackgroundColor="Red"
                                            TextColor="White"
                                            WidthRequest="70"
                                            HeightRequest="32"
                                            HorizontalOptions="End"
                                            VerticalOptions="Center"/>
                                </Grid>
                                <Grid IsVisible="{OnPlatform  Default=False, Android=True, iOS=True, MacCatalyst=False}"
                                      RowDefinitions="Auto,Auto,Auto,Auto,Auto,Auto,Auto"
                                      ColumnDefinitions="100,*"
                                      RowSpacing="18"
                                      Padding="0,8">
                                    <Label Text="Line ID" VerticalTextAlignment="Center" FontAttributes="Bold" Grid.Column="0" Grid.Row="0" />
                                    <Label VerticalTextAlignment="Center" Text="{Binding LineId}" Grid.Column="1" Grid.Row="0" />

                                    <Label Text="Article Code" VerticalTextAlignment="Center" FontAttributes="Bold" Grid.Column="0" Grid.Row="1" />
                                    <Label VerticalTextAlignment="Center" Text="{Binding ArticleCode}" Grid.Column="1" Grid.Row="1"/>

                                    <Label Text="Quantity" VerticalTextAlignment="Center" FontAttributes="Bold" Grid.Column="0" Grid.Row="2" />
                                    <HorizontalStackLayout HorizontalOptions="Start" Spacing="4" Grid.Column="1" Grid.Row="2">
                                        <Button Text="-" 
                                                Command="{Binding DecrementQuantityCommand}" 
                                                WidthRequest="32" HeightRequest="32"/>
                                        <Label Text="{Binding Quantity}" 
                                                WidthRequest="40"
                                                HorizontalTextAlignment="Center"
                                                VerticalTextAlignment="Center"
                                                FontSize="16"/>
                                        <Button Text="+"
                                                Command="{Binding IncrementQuantityCommand}" 
                                                WidthRequest="32" HeightRequest="32"/>
                                    </HorizontalStackLayout>
                                    
                                    <Label Text="Reason" VerticalTextAlignment="Center" FontAttributes="Bold" Grid.Column="0" Grid.Row="3" />
                                    <Label VerticalTextAlignment="Center" Text="{Binding Reason}" Grid.Column="1"  Grid.Row="3"/>

                                    <Label Text="Resolution" VerticalTextAlignment="Center" FontAttributes="Bold" Grid.Column="0" Grid.Row="4" />
                                    <Picker Grid.Column="1" Grid.Row="4"
                                            SelectedItem="{Binding Resolution, Mode=TwoWay}"
                                            VerticalOptions="Center"
                                            WidthRequest="200"
                                            HorizontalOptions="Start">
                                        <Picker.Items>
                                            <x:String>refund</x:String>
                                            <x:String>doNotRefund</x:String>
                                            <x:String>check</x:String>
                                        </Picker.Items>
                                    </Picker>

                                    <Label Text="Condition" VerticalTextAlignment="Center" FontAttributes="Bold" Grid.Column="0" Grid.Row="5" />
                                    <Picker Grid.Column="1" Grid.Row="5"
                                            SelectedItem="{Binding Condition, Mode=TwoWay}"
                                            VerticalOptions="Center"
                                            WidthRequest="200"
                                            HorizontalOptions="Start">
                                        <Picker.Items>
                                            <x:String>secondChange</x:String>
                                            <x:String>restockable</x:String>
                                            <x:String>scrap</x:String>
                                        </Picker.Items>
                                    </Picker>
                                    <Button Grid.Column="0" Grid.ColumnSpan="2" Grid.Row="6"
                                            Text="Delete"
                                            Command="{Binding BindingContext.DeleteLineCommand, Source={x:Reference RmaDetailPageRoot}}"
                                            CommandParameter="{Binding .}"
                                            BackgroundColor="Red"
                                            TextColor="White"
                                            WidthRequest="70"
                                            HeightRequest="32"
                                            Margin="0,20,0,0"
                                            HorizontalOptions="Center"
                                            VerticalOptions="Center"/>
                                </Grid>
                            </VerticalStackLayout>
                        </Border>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>
            <Label Text="{Binding ErrorMessage}"
                       TextColor="Red"
                       IsVisible="{Binding ErrorMessage, Converter={StaticResource StringNotEmptyConverter}}" />
            <Button 
                Text="Book Return"
                Command="{Binding BookReturnCommand}"
                HorizontalOptions="End"
                Margin="0,0,0,10"/>
        </VerticalStackLayout>
    </ScrollView>
</ContentPage>